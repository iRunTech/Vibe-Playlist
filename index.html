<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibe Playlist</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .input-group {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            align-items: center;
        }

        #vibeInput {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }

        #vibeInput:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        button:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }

        #generateBtn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        #generateBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        #generateBtn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        #copyBtn {
            background: #10b981;
            color: white;
        }

        #copyBtn:hover:not(:disabled) {
            background: #059669;
        }

        #copyBtn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
        }

        #status {
            font-size: 14px;
            color: #6b7280;
            min-height: 20px;
        }

        .results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .track-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .track-card:hover {
            transform: translateY(-4px);
        }

        .track-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: #f3f4f6;
        }

        .track-info {
            padding: 16px;
        }

        .track-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
            line-height: 1.3;
        }

        .track-artist {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 12px;
        }

        .play-btn {
            width: 100%;
            background: #667eea;
            color: white;
            padding: 8px 16px;
            font-size: 14px;
        }

        .play-btn:hover:not(:disabled) {
            background: #5a67d8;
        }

        .play-btn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transform: translateX(100px);
            transition: all 0.3s;
            z-index: 1000;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .loading {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @media (max-width: 768px) {
            .input-group {
                flex-direction: column;
            }

            .results {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Vibe Playlist</h1>
            <div class="input-group">
                <input type="text" id="vibeInput" placeholder="e.g. chill coding, rainy coffee shop">
                <button id="generateBtn">Generate</button>
                <button id="copyBtn" disabled>Copy playlist</button>
            </div>
            <div id="status"></div>
        </header>

        <div id="results" class="results"></div>
    </div>

    <div id="toast" class="toast">Copied!</div>

    <script>
        class VibePlaylist {
            constructor() {
                this.currentAudio = null;
                this.currentPlayingBtn = null;
                this.tracks = [];

                this.vibeInput = document.getElementById('vibeInput');
                this.generateBtn = document.getElementById('generateBtn');
                this.copyBtn = document.getElementById('copyBtn');
                this.status = document.getElementById('status');
                this.results = document.getElementById('results');
                this.toast = document.getElementById('toast');

                this.init();
            }

            init() {
                this.loadSavedVibe();
                this.bindEvents();
            }

            bindEvents() {
                this.generateBtn.addEventListener('click', () => this.generatePlaylist());
                this.copyBtn.addEventListener('click', () => this.copyPlaylist());
                this.vibeInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.generatePlaylist();
                });
                this.vibeInput.addEventListener('input', () => this.saveVibe());
            }

            loadSavedVibe() {
                const savedVibe = localStorage.getItem('lastVibe');
                if (savedVibe) {
                    this.vibeInput.value = savedVibe;
                }
            }

            saveVibe() {
                localStorage.setItem('lastVibe', this.vibeInput.value);
            }

            async generatePlaylist() {
                const query = this.vibeInput.value.trim();
                if (!query) {
                    this.showStatus('Please enter a vibe!', 'error');
                    return;
                }

                this.setLoading(true);
                this.showStatus('Searching for tracks...', 'loading');

                try {
                    const response = await fetch(`https://corsproxy.io/?https://api.deezer.com/search?q=${encodeURIComponent(query)}&limit=10`);

                    if (!response.ok) {
                        throw new Error(`API error: ${response.status}`);
                    }

                    const data = await response.json();

                    if (!data.data || data.data.length === 0) {
                        this.showStatus('No tracks found. Try a different vibe!', 'error');
                        this.setLoading(false);
                        return;
                    }

                    this.tracks = data.data;
                    this.displayTracks();
                    this.showStatus(`Found ${this.tracks.length} tracks`, 'success');
                    this.copyBtn.disabled = false;

                } catch (error) {
                    console.error('Error fetching tracks:', error);
                    this.showStatus('Error loading tracks. Please try again.', 'error');
                } finally {
                    this.setLoading(false);
                }
            }

            displayTracks() {
                this.results.innerHTML = '';

                this.tracks.forEach((track, index) => {
                    const card = document.createElement('div');
                    card.className = 'track-card';

                    const hasPreview = track.preview && track.preview !== '';

                    card.innerHTML = `
                        <img src="${track.album.cover_medium}" alt="${track.title}" class="track-image" loading="lazy">
                        <div class="track-info">
                            <div class="track-title">${this.escapeHtml(track.title)}</div>
                            <div class="track-artist">${this.escapeHtml(track.artist.name)}</div>
                            <button class="play-btn" data-index="${index}" ${!hasPreview ? 'disabled' : ''}>
                                ${hasPreview ? 'Play' : 'No Preview'}
                            </button>
                        </div>
                    `;

                    if (hasPreview) {
                        const playBtn = card.querySelector('.play-btn');
                        playBtn.addEventListener('click', () => this.togglePlay(track, playBtn));
                    }

                    this.results.appendChild(card);
                });
            }

            togglePlay(track, button) {
                if (this.currentAudio && !this.currentAudio.paused) {
                    this.currentAudio.pause();
                    this.currentPlayingBtn.textContent = 'Play';

                    if (this.currentPlayingBtn === button) {
                        this.currentAudio = null;
                        this.currentPlayingBtn = null;
                        return;
                    }
                }

                this.currentAudio = new Audio(track.preview);
                this.currentPlayingBtn = button;

                button.textContent = 'Loading...';
                button.disabled = true;

                this.currentAudio.addEventListener('loadeddata', () => {
                    button.textContent = 'Pause';
                    button.disabled = false;
                });

                this.currentAudio.addEventListener('ended', () => {
                    button.textContent = 'Play';
                    this.currentAudio = null;
                    this.currentPlayingBtn = null;
                });

                this.currentAudio.addEventListener('error', () => {
                    button.textContent = 'Error';
                    this.currentAudio = null;
                    this.currentPlayingBtn = null;
                });

                this.currentAudio.play();
            }

            copyPlaylist() {
                if (!this.tracks.length) return;

                const playlist = this.tracks.map((track, index) =>
                    `${index + 1}. ${track.title} - ${track.artist.name}`
                ).join('\n');

                const fullText = `Vibe Playlist: "${this.vibeInput.value}"\n\n${playlist}`;

                navigator.clipboard.writeText(fullText).then(() => {
                    this.showToast();
                }).catch(() => {
                    const textArea = document.createElement('textarea');
                    textArea.value = fullText;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    this.showToast();
                });
            }

            showToast() {
                this.toast.classList.add('show');
                setTimeout(() => {
                    this.toast.classList.remove('show');
                }, 2000);
            }

            showStatus(message, type = 'info') {
                this.status.textContent = message;
                this.status.className = type;
            }

            setLoading(loading) {
                this.generateBtn.disabled = loading;
                this.generateBtn.textContent = loading ? 'Searching...' : 'Generate';
                if (loading) {
                    this.generateBtn.classList.add('loading');
                } else {
                    this.generateBtn.classList.remove('loading');
                }
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }

        new VibePlaylist();
    </script>
</body>
</html>